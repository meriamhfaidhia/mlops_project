#!/bin/bash

set -e  # ArrÃªter le script en cas d'erreur

# DÃ©finir le dossier du projet
PROJECT_DIR="/home/meriam/meriam-hfaidhia-4DS4-mlops_project"

cd "$PROJECT_DIR"

# Activer l'environnement virtuel
. venv/bin/activate

# VÃ©rifier si un processus tourne dÃ©jÃ 
if [ -f uvicorn_pid.txt ]; then
    PID=$(cat uvicorn_pid.txt)
    if ps -p $PID > /dev/null; then
        echo "âš ï¸ L'API tourne dÃ©jÃ  avec le PID $PID."
        exit 1
    fi
fi

# Lancer FastAPI avec nohup et sauvegarder le PID
nohup uvicorn app:app --host 0.0.0.0 --port 8000 --reload > uvicorn.log 2>&1 &
echo $! > uvicorn_pid.txt

echo "ğŸš€ API dÃ©marrÃ©e avec succÃ¨s. PID: $(cat uvicorn_pid.txt)"
echo "ğŸŒ AccÃ©dez Ã  Swagger : http://192.168.93.6:8000/docs"

